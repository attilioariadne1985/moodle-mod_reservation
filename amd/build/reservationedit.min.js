define ("mod_reservation/reservationedit",["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){var h={CLASHBUTTON:"#checkclashes",PLACEFIELD:"#id_locationtext",PLACESELECT:"#id_location",TIMESTART:"#id_timestart",TIMEEND:"#id_timeend",BULKFIELD:"select.field",BULKMATCHVALUE:"div.matchvalue input"},i=function(a){this.courseId=a.courseid;this.attachEventListeners()};i.prototype.courseId=-1;i.prototype.modal=null;i.prototype.attachEventListeners=function(){a(h.BULKMATCHVALUE).on("focus",function(b){a(b.target).blur();var c=a(b.target).attr("id");this.showMatchvalues(c).fail(f.exception)}.bind(this));a(h.CLASHBUTTON).on("click",function(){this.showClashes().fail(f.exception)}.bind(this));a(h.BULKFIELD).on("change",function(b){var c=a(b.target).attr("id"),d=c.replace("field","matchvalue");a("#"+d).prop("value","")})};i.prototype.showMatchvalues=function(e){var h=e.replace("matchvalue","field"),i=a("#"+h).val();if(""==i){return a.Deferred().resolve().promise()}var j=b.get_string("selectvalue","mod_reservation"),k=b.get_string("novalues","mod_reservation");return a.when(c.create({type:c.types.SAVE_CANCEL}),j,k).then(function(b,c,j){this.modal=b;this.modal.setTitle(c);this.modal.setBody(j);j=g.call([{methodname:"mod_reservation_get_matchvalues",args:{fieldname:i,courseid:this.courseId}}])[0].then(function(b){if(0<b.length){for(var c="<ul>",d=0,e;d<b.length;d++){e=a("<div/>").text(b[d]).html();c+="<li class=\"matchvalues\">";c+="<input type=\"radio\" name=\"matchvalue\" value=\""+e+"\" id=\"value_"+d+"\" />";c+="<label for=\"value_"+d+"\">"+e+"</label>";c+="</li>"}c+="</ul>";this.modal.setBody(c);return!0}}.bind(this)).catch(f.exception);this.modal.getRoot().on(d.hidden,function(){a("#"+h).focus();this.modal.getRoot().remove()}.bind(this));this.modal.getRoot().on(d.save,function(){var b=a("input[name='matchvalue']:checked").val();a("#"+e).prop("value",b)});this.modal.show();return this.modal}.bind(this))};i.prototype.showClashes=function(){var e=a(h.PLACESELECT).val();if(0==e){e=a(h.PLACEFIELD).val()}var i=a(h.TIMESTART+"_day").val(),j=a(h.TIMESTART+"_month").val(),k=a(h.TIMESTART+"_year").val(),l=a(h.TIMESTART+"_hour").val(),m=a(h.TIMESTART+"_minute").val(),n="";if(a(h.TIMEEND+"_enabled").is(":checked")){var o=a(h.TIMEEND+"_day").val(),p=a(h.TIMEEND+"_month").val(),q=a(h.TIMEEND+"_year").val(),r=a(h.TIMEEND+"_hour").val(),s=a(h.TIMEEND+"_minute").val();n=q+"-"+p+"-"+o+"-"+r+"-"+s}var t=a("input[name='instance']").val(),u=b.get_string("clashesreport","mod_reservation"),v=b.get_string("noclashes","mod_reservation");return a.when(c.create({type:c.types.CANCEL}),u,v).then(function(b,c,o){this.modal=b;this.modal.setTitle(c);this.modal.setBody(o);o=g.call([{methodname:"mod_reservation_get_clashes",args:{courseid:this.courseId,place:e,timestart:k+"-"+j+"-"+i+"-"+l+"-"+m,timeend:n,reservationid:t}}])[0].then(function(a){if(null!==a){this.modal.setBody(a);return!0}}.bind(this)).catch(f.exception);this.modal.getRoot().on(d.hidden,function(){a(h.CLASHBUTTON).focus();this.modal.getRoot().remove()}.bind(this));this.modal.show();return this.modal}.bind(this))};return{init:function init(a){return new i(a)}}});
//# sourceMappingURL=reservationedit.min.js.map
